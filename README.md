# 内存池管理项目

 ## 项目简介 ## 

本项目实现了一个高效的内存池管理系统，借鉴了 Nginx 的内存池设计，旨在提供一个灵活的内存分配和管理解决方案。内存池是内存管理的一个重要工具，通过预分配一块较大的内存区域，然后在该区域内进行小块内存的分配和回收，从而减少频繁的内存申请和释放操作，提高程序的性能和效率。该项目适用于需要频繁进行内存分配和释放的场景，如高性能服务器、实时系统和嵌入式系统等。



## 核心功能 ##

**内存池创建**：可以创建指定大小的内存池，并进行初始化。内存池可以在其生命周期内管理多个小块内存的分配和释放。

**内存分配**：支持小块内存和大块内存的分配。小块内存用于频繁分配的内存块，大块内存用于较大内存需求的分配。 

**内存释放**：提供了内存释放机制，可以释放大块内存，但不支持释放小块内存。

**内存池重置**：能够重置内存池的状态，使其准备好进行新的内存分配。重置操作会保留内存池的结构，但会清除之前分配的内存数据。

**内存池销毁**：销毁内存池并释放所有分配的资源，包括大块内存，小块内存以及内部数据结构。 

**清理函数**：允许用户在内存池销毁时注册清理函数，以处理内存池内资源的额外清理操作。



## 功能概述 

1. **内存池创建 (`ngx_mem_pool::ngx_mem_pool`)**：初始化一个新的内存池实例，分配指定大小的内存空间，并设置内存池的初始状态， 提供基础的内存分配和管理功能。
1.  **内存分配 (`ngx_mem_pool::ngx_palloc` 和 `ngx_mem_pool::ngx_palloc_large`)**：支持大小块内存的分配：对于较小的内存块，使用内存池内部的快速分配机制。对于较大的内存块，使用独立的内存分配机制，并维护一个大块内存列表。 
1.  **内存释放 (`ngx_mem_pool::ngx_pfree`)**： 释放分配的大块内存，更新内存池中的大块内存列表，以避免内存泄漏。
1.  **内存池重置 (`ngx_mem_pool::ngx_reset_pool`)**：重置内存池的状态，释放大块内存，将内存池中的所有小块内存标记为未使用，并将当前内存池指针恢复到初始状态。 
1. **内存池销毁 (`ngx_mem_pool::ngx_destory_pool`)**：销毁内存池，释放所有内存块和相关资源并调用所有注册的清理函数，以确保所有内存池内的资源得到妥善处理和释放。
1.  **清理函数管理 (`ngx_mem_pool::ngx_pool_cleanup_add`)**： 添加清理函数到内存池的清理列表中， 清理函数将在内存池销毁时被调用，用于执行额外的资源清理操作。